<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sheepdog Spirit</title>
    <link rel="stylesheet" href="https://use.typekit.net/kmh8zve.css">
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #87CEEB;
            color: black;
            font-family: "owners-narrow", sans-serif;
        }
        h1 {
            margin: 20px 0;
            font-size: 56px;
            text-align: center;
            font-family: "handsome-pro", sans-serif;
            font-weight: 700;
            font-style: normal;
        }
        p {
            margin: 10px 0;
            font-size: 16px;
            text-align: center;
            font-family: "owners-narrow", sans-serif;
            font-weight: 400;
            font-style: normal;
        }
        .game-wrapper {
            position: relative;
            width: 100%;
            max-width: 800px;
            padding-bottom: 75%; /* 4:3 aspect ratio */
            margin: 0 auto;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 1px solid black;
            background-color: #32CD32;
            touch-action: none; /* Prevents default touch behaviors like scrolling */
        }
    </style>
</head>
<body>
    <h1>Sheepdog Spirit!</h1>
    <div class="game-wrapper">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>
    <p>Use arrow keys to move Spirit. Herd sheep into the gate to score points.<br>Press space to bark (costs 5 points). Donâ€™t let them escape through the wall gaps!</p>
    <p>Made by <a href="https://www.catebligh.com" target="_blank">Cate Bligh</a> with <a href="https://www.grok.com" target="_blank">Grok</a></p>
    <script>

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Game state (example placeholders; adjust to match your game)
let score = 0;
let lives = 5;
let lastBarkTime = 0;
const barkCooldown = 500; // 0.5 seconds

// Spirit (sheepdog)
const spirit = {
    x: 400,
    y: 300,
    width: 24,
    height: 16,
    speed: 4
};

// Input handling
const keys = {
    ArrowLeft: false,
    ArrowRight: false,
    ArrowUp: false,
    ArrowDown: false,
    Space: false
};

// Touch control variables
let isDragging = false;
let startPos = { x: 0, y: 0 };
let lastTapTime = 0;
const doubleTapThreshold = 300; // ms for double-tap detection
const tapMovementThreshold = 10; // pixels to distinguish tap from drag

// Touch event listeners
canvas.addEventListener('touchstart', (e) => {
    e.preventDefault(); // Prevent default behavior (e.g., scrolling)
    const touch = e.touches[0];
    startPos = { x: touch.clientX, y: touch.clientY };
    isDragging = false;

    const currentTime = performance.now();
    if (currentTime - lastTapTime < doubleTapThreshold) {
        // Double-tap detected
        if (score >= 5 && currentTime - lastBarkTime >= barkCooldown) {
            bark(currentTime);
        }
    }
    lastTapTime = currentTime;
}, { passive: false });

canvas.addEventListener('touchmove', (e) => {
    e.preventDefault();
    const touch = e.touches[0];
    const dx = touch.clientX - startPos.x;
    const dy = touch.clientY - startPos.y;

    // Start dragging if movement exceeds threshold
    if (!isDragging && (Math.abs(dx) > tapMovementThreshold || Math.abs(dy) > tapMovementThreshold)) {
        isDragging = true;
    }

    if (isDragging) {
        if (Math.abs(dx) > Math.abs(dy)) {
            // Horizontal movement
            keys.ArrowLeft = dx < 0;
            keys.ArrowRight = dx > 0;
            keys.ArrowUp = false;
            keys.ArrowDown = false;
        } else {
            // Vertical movement
            keys.ArrowUp = dy < 0;
            keys.ArrowDown = dy > 0;
            keys.ArrowLeft = false;
            keys.ArrowRight = false;
        }
    }
}, { passive: false });

canvas.addEventListener('touchend', (e) => {
    e.preventDefault();
    // Reset movement keys
    keys.ArrowLeft = false;
    keys.ArrowRight = false;
    keys.ArrowUp = false;
    keys.ArrowDown = false;
    isDragging = false;
}, { passive: false });

// Keyboard controls (unchanged; included for completeness)
window.addEventListener('keydown', (e) => {
    if (keys.hasOwnProperty(e.code)) {
        keys[e.code] = true;
        if (e.code === 'Space' && score >= 5 && performance.now() - lastBarkTime >= barkCooldown) {
            bark(performance.now());
        }
    }
});
window.addEventListener('keyup', (e) => {
    if (keys.hasOwnProperty(e.code)) keys[e.code] = false;
});

// Bark function (example; adjust to your game)
function bark(timestamp) {
    lastBarkTime = timestamp;
    score -= 5; // Deduct points
    console.log('Spirit barks!'); // Replace with your bark logic
    // Example: Add bark effects, push sheep, etc.
}

// Game loop (example; adjust to your game)
function gameLoop(timestamp) {
    // Update Spirit's position based on keys
    if (keys.ArrowLeft) spirit.x -= spirit.speed;
    if (keys.ArrowRight) spirit.x += spirit.speed;
    if (keys.ArrowUp) spirit.y -= spirit.speed;
    if (keys.ArrowDown) spirit.y += spirit.speed;
    spirit.x = Math.max(0, Math.min(800 - spirit.width, spirit.x));
    spirit.y = Math.max(0, Math.min(600 - spirit.height, spirit.y));

    // Clear and redraw (example)
    ctx.clearRect(0, 0, 800, 600);
    ctx.fillStyle = 'black';
    ctx.fillRect(spirit.x, spirit.y, spirit.width, spirit.height);
    ctx.fillText(`Score: ${score}  Lives: ${lives}`, 10, 20);

    // Continue game loop
    requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);
        
    </script>
</body>
</html>
